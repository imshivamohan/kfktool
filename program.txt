import json
from azure.identity import DefaultAzureCredential
from azure.keyvault.secrets import SecretClient

# Initialize Azure Key Vault client
vault_url = "https://<your-vault-name>.vault.azure.net"
credential = DefaultAzureCredential()
secret_client = SecretClient(vault_url=vault_url, credential=credential)

def encrypt_field(plaintext):
    encrypted_value = secret_client.encrypt(key_id="<your-key-id>", algorithm="RSA-OAEP", plaintext=plaintext.encode("utf-8"))
    return encrypted_value.ciphertext

def decrypt_field(ciphertext):
    decrypted_value = secret_client.decrypt(key_id="<your-key-id>", algorithm="RSA-OAEP", ciphertext=ciphertext)
    return decrypted_value.plaintext.decode("utf-8")

original_json = {
    "name": "Modi",
    "age": 66
}

# Print the original JSON
print("Original JSON:")
print(original_json)

# Encrypt the "name" field
encrypted_name = encrypt_field(original_json["name"])

# Encrypt the "age" field
encrypted_age = encrypt_field(str(original_json["age"]))

# Store the encrypted values in Azure Key Vault
secret_client.set_secret("encrypted_name", encrypted_name)
secret_client.set_secret("encrypted_age", encrypted_age)

# Retrieve the encrypted values from Azure Key Vault
encrypted_name = secret_client.get_secret("encrypted_name").value
encrypted_age = secret_client.get_secret("encrypted_age").value

# Decrypt the "name" field
decrypted_name = decrypt_field(encrypted_name)

# Decrypt the "age" field
decrypted_age = int(decrypt_field(encrypted_age))

# Update the JSON with the decrypted values
original_json["name"] = decrypted_name
original_json["age"] = decrypted_age

# Print the decrypted JSON
print("\nDecrypted JSON:")
print(original_json)n

