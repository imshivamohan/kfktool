import json
from azure.identity import DefaultAzureCredential
from azure.keyvault.secrets import SecretClient
from cryptography.fernet import Fernet

vault_url = "https://<your-vault-name>.vault.azure.net"
credential = DefaultAzureCredential()
secret_client = SecretClient(vault_url=vault_url, credential=credential)

def encrypt_field(plaintext, encryption_key):
    cipher_suite = Fernet(encryption_key)
    plaintext_bytes = bytes(json.dumps(plaintext), encoding="utf-8")
    encrypted_bytes = cipher_suite.encrypt(plaintext_bytes)
    return encrypted_bytes

def decrypt_field(ciphertext, encryption_key):
    cipher_suite = Fernet(encryption_key)
    decrypted_bytes = cipher_suite.decrypt(ciphertext)
    decrypted_plaintext = decrypted_bytes.decode("utf-8")
    return json.loads(decrypted_plaintext)

original_json = {
    "name": "Modi",
    "age": 66
}

print("Original JSON:")
print(original_json)

encryption_key = secret_client.get_secret("<your-key-id>").value

encrypted_name = encrypt_field(original_json["name"], encryption_key)
encrypted_age = encrypt_field(original_json["age"], encryption_key)

encrypted_json = {
    "encrypted_name": encrypted_name,
    "encrypted_age": encrypted_age
}

print("\nEncrypted JSON:")
print(encrypted_json)

decrypted_name = decrypt_field(encrypted_name, encryption_key)
decrypted_age = decrypt_field(encrypted_age, encryption_key)

original_json["name"] = decrypted_name
original_json["age"] = decrypted_age

print("\nDecrypted JSON:")
print(original_json)
