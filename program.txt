from confluent_kafka import SerializingProducer
from confluent_kafka.schema_registry import SchemaRegistryClient
from confluent_kafka.serialization import StringSerializer, JSONSerializer

import json

# Kafka broker and topic configuration
bootstrap_servers = 'localhost:9092'
topic = 'test-topic'

# Schema Registry configuration
schema_registry_url = 'http://localhost:8081'

# Example JSON message
message = {
    'name': 'Alice',
    'age': 30,
    'email': 'alice@example.com'
}

# Initialize Schema Registry client
schema_registry_client = SchemaRegistryClient({'url': schema_registry_url})

# Define a serializer using the Schema Registry client
key_serializer = StringSerializer('utf_8')
value_serializer = JSONSerializer(schema_registry_client)

# Configure the producer
producer_config = {
    'bootstrap.servers': bootstrap_servers,
    'key.serializer': key_serializer,
    'value.serializer': value_serializer
}

# Create the producer
producer = SerializingProducer(producer_config)

# Produce the message
producer.produce(topic=topic, key='some-key', value=message)

# Flush any outstanding messages
producer.flush()

# Close the producer
producer.close()
